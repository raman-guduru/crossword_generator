<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crossword Puzzle Generator</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;
        
        // Lucide icons as inline SVG components
        const Upload = ({ className = "w-6 h-6" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
            </svg>
        );
        
        const Play = ({ className = "w-6 h-6" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        );
        
        const Download = ({ className = "w-4 h-4" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
            </svg>
        );
        
        const Loader2 = ({ className = "w-6 h-6" }) => (
            <svg className={`${className} animate-spin`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            </svg>
        );
        
        const CheckCircle = ({ className = "w-5 h-5" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        );
        
        const AlertCircle = ({ className = "w-5 h-5" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        );
        
        const Trash2 = ({ className = "w-5 h-5" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
        );

        const API_URL = 'http://localhost:5000/api';

        function CrosswordGenerator() {
          const [wordFile, setWordFile] = useState(null);
          const [uploadedData, setUploadedData] = useState(null);
          const [gridSize, setGridSize] = useState(12);
          const [minQuality, setMinQuality] = useState(60);
          const [status, setStatus] = useState('idle');
          const [result, setResult] = useState(null);
          const [errorMessage, setErrorMessage] = useState('');
          const [logs, setLogs] = useState([]);
          const [timing, setTiming] = useState(null);
          const [cnfPath, setCnfPath] = useState(null);

          const addLog = (message) => {
            setLogs(prev => [...prev, `[${new Date().toLocaleTimeString()}] ${message}`]);
          };

          const handleFileUpload = async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            setWordFile(file);
            setLogs([]);
            addLog(`Uploading ${file.name}...`);

            const formData = new FormData();
            formData.append('file', file);

            try {
              const response = await fetch(`${API_URL}/upload`, {
                method: 'POST',
                body: formData,
              });

              const data = await response.json();

              if (response.ok) {
                setUploadedData(data);
                addLog(`✓ Loaded ${data.word_count} words from ${file.name}`);
                addLog(`  Longest word: ${data.longest_word} (${data.longest_length} letters)`);
                setErrorMessage('');
              } else {
                addLog(`✗ Error: ${data.error}`);
                setErrorMessage(data.error);
                setWordFile(null);
              }
            } catch (error) {
              addLog(`✗ Connection error: ${error.message}`);
              setErrorMessage('Failed to connect to server. Make sure the Flask backend is running.');
              setWordFile(null);
            }
          };

          const generateCrossword = async () => {
            if (!uploadedData) {
              setErrorMessage('Please upload a word file first');
              return;
            }

            setStatus('processing');
            setResult(null);
            setErrorMessage('');
            setLogs([]);
            setCnfPath(null);
            setTiming(null);
            
            addLog('Starting crossword generation...');
            addLog(`Grid size: ${gridSize}x${gridSize}`);
            addLog(`Minimum quality: ${minQuality}`);

            try {
              const response = await fetch(`${API_URL}/generate`, {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                  filepath: uploadedData.filepath,
                  grid_size: gridSize,
                  min_quality: minQuality,
                }),
              });

              const data = await response.json();

              if (data.logs) {
                data.logs.forEach(log => addLog(log));
              }

              if (data.success) {
                addLog(`✓ Success! Placed ${data.result.word_count} words (${data.result.total_length} symbols)`);
                setResult(data.result);
                setTiming(data.timing);
                setCnfPath(data.cnf_path);
                setStatus('success');
              } else {
                addLog(`✗ ${data.error}`);
                setErrorMessage(data.error);
                setStatus('error');
              }

            } catch (error) {
              addLog(`✗ Error: ${error.message}`);
              setErrorMessage('Failed to generate crossword. Check server connection.');
              setStatus('error');
            }
          };

          const downloadCNF = async () => {
            if (!cnfPath) {
              setErrorMessage('CNF file not available');
              return;
            }

            try {
              const response = await fetch(`${API_URL}/download-cnf`, {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify({ cnf_path: cnfPath }),
              });

              if (response.ok) {
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'crossword.cnf';
                a.click();
                window.URL.revokeObjectURL(url);
                addLog('✓ CNF file downloaded');
              } else {
                addLog('✗ Failed to download CNF file');
              }
            } catch (error) {
              addLog(`✗ Download error: ${error.message}`);
            }
          };

          const clearFile = () => {
            setWordFile(null);
            setUploadedData(null);
            setResult(null);
            setLogs([]);
            setErrorMessage('');
            setStatus('idle');
          };

          return (
            <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-6">
              <div className="max-w-7xl mx-auto">
                <div className="text-center mb-8">
                  <h1 className="text-5xl font-bold text-white mb-2">
                    Crossword Puzzle Generator
                  </h1>
                  <p className="text-purple-200 text-lg">
                    Generate crossword puzzles using SAT/SMT solvers
                  </p>
                  <div className="mt-2 text-sm text-purple-300">
                    Backend: {API_URL}
                  </div>
                </div>

                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                  <div className="space-y-6">
                    <div className="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20">
                      <h2 className="text-2xl font-semibold text-white mb-4 flex items-center gap-2">
                        <Upload />
                        Word List File
                      </h2>
                      
                      <div className="space-y-4">
                        {!wordFile ? (
                          <label className="block">
                            <div className="border-2 border-dashed border-purple-400 rounded-lg p-6 text-center cursor-pointer hover:border-purple-300 transition-colors">
                              <input
                                type="file"
                                accept=".txt"
                                onChange={handleFileUpload}
                                className="hidden"
                              />
                              <div className="flex justify-center mb-3">
                                <Upload className="w-12 h-12 text-purple-300" />
                              </div>
                              <p className="text-white font-medium mb-1">
                                Click to upload word list
                              </p>
                              <p className="text-purple-200 text-sm">
                                .txt file with one word per line (e.g., medium.txt)
                              </p>
                            </div>
                          </label>
                        ) : (
                          <div className="bg-green-500/20 border border-green-400 rounded-lg p-4">
                            <div className="flex items-start justify-between gap-2">
                              <div className="flex items-start gap-2 flex-1">
                                <CheckCircle className="text-green-400 flex-shrink-0 mt-0.5" />
                                <div className="text-sm">
                                  <p className="text-green-100 font-medium">{wordFile.name}</p>
                                  {uploadedData && (
                                    <>
                                      <p className="text-green-200">
                                        {uploadedData.word_count} words loaded
                                      </p>
                                      <p className="text-green-300 text-xs mt-1">
                                        Longest: {uploadedData.longest_word} ({uploadedData.longest_length} chars)
                                      </p>
                                    </>
                                  )}
                                </div>
                              </div>
                              <button
                                onClick={clearFile}
                                className="text-green-300 hover:text-green-100 transition-colors"
                              >
                                <Trash2 />
                              </button>
                            </div>
                          </div>
                        )}
                      </div>
                    </div>

                    <div className="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20">
                      <h2 className="text-2xl font-semibold text-white mb-4">
                        Configuration
                      </h2>
                      
                      <div className="space-y-4">
                        <div>
                          <label className="block text-white font-medium mb-2">
                            Grid Size: {gridSize}x{gridSize}
                          </label>
                          <input
                            type="range"
                            min="5"
                            max="20"
                            value={gridSize}
                            onChange={(e) => setGridSize(Number(e.target.value))}
                            className="w-full h-2 bg-purple-600 rounded-lg appearance-none cursor-pointer"
                          />
                          <div className="flex justify-between text-xs text-purple-300 mt-1">
                            <span>5x5 (fast)</span>
                            <span>20x20 (slow)</span>
                          </div>
                        </div>

                        <div>
                          <label className="block text-white font-medium mb-2">
                            Minimum Quality: {minQuality}
                          </label>
                          <input
                            type="range"
                            min="20"
                            max="150"
                            step="10"
                            value={minQuality}
                            onChange={(e) => setMinQuality(Number(e.target.value))}
                            className="w-full h-2 bg-purple-600 rounded-lg appearance-none cursor-pointer"
                          />
                          <div className="flex justify-between text-xs text-purple-300 mt-1">
                            <span>Low (20)</span>
                            <span>High (150)</span>
                          </div>
                          <p className="text-purple-200 text-sm mt-2">
                            Sum of word lengths to place. Higher = more words required
                          </p>
                        </div>
                      </div>
                    </div>

                    <button
                      onClick={generateCrossword}
                      disabled={!uploadedData || status === 'processing'}
                      className="w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 disabled:from-gray-600 disabled:to-gray-700 text-white font-bold py-4 px-6 rounded-xl flex items-center justify-center gap-3 transition-all transform hover:scale-105 disabled:scale-100 disabled:cursor-not-allowed"
                    >
                      {status === 'processing' ? (
                        <>
                          <Loader2 />
                          Generating...
                        </>
                      ) : (
                        <>
                          <Play />
                          Generate Crossword
                        </>
                      )}
                    </button>

                    {timing && (
                      <div className="bg-blue-500/20 border border-blue-400 rounded-lg p-4">
                        <h3 className="text-blue-100 font-semibold mb-2">Performance</h3>
                        <div className="grid grid-cols-2 gap-2 text-sm text-blue-200">
                          <div>Encoding: {timing.encoding?.toFixed(2) || 'N/A'}s</div>
                          <div>CNF Export: {timing.cnf_export?.toFixed(2) || 'N/A'}s</div>
                          <div>Solving: {timing.solving?.toFixed(2) || 'N/A'}s</div>
                          <div className="font-semibold">Total: {timing.total?.toFixed(2) || 'N/A'}s</div>
                        </div>
                      </div>
                    )}
                  </div>

                  <div className="space-y-6">
                    <div className="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20 h-64 overflow-auto">
                      <h2 className="text-2xl font-semibold text-white mb-4">
                        Console Output
                      </h2>
                      
                      {logs.length === 0 ? (
                        <p className="text-purple-300 text-sm">
                          Upload a word list and click "Generate Crossword" to start...
                        </p>
                      ) : (
                        <div className="space-y-1 font-mono text-xs">
                          {logs.map((log, idx) => (
                            <div key={idx} className="text-green-300">
                              {log}
                            </div>
                          ))}
                        </div>
                      )}

                      {errorMessage && (
                        <div className="mt-4 bg-red-500/20 border border-red-400 rounded-lg p-3 flex items-start gap-2">
                          <AlertCircle className="text-red-400 flex-shrink-0 mt-0.5" />
                          <p className="text-red-100 text-sm">{errorMessage}</p>
                        </div>
                      )}
                    </div>

                    {result && (
                      <div className="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20">
                        <div className="flex items-center justify-between mb-4">
                          <h2 className="text-2xl font-semibold text-white">
                            Crossword Grid
                          </h2>
                          {cnfPath && (
                            <button
                              onClick={downloadCNF}
                              className="flex items-center gap-2 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors text-sm"
                            >
                              <Download />
                              CNF
                            </button>
                          )}
                        </div>

                        <div className="mb-4 text-purple-200 text-sm">
                          Placed {result.word_count} words ({result.total_length} symbols)
                        </div>

                        <div className="bg-black/30 rounded-lg p-4 overflow-auto">
                          <div className="inline-block">
                            {result.grid.map((row, y) => (
                              <div key={y} className="flex">
                                {row.map((cell, x) => (
                                  <div
                                    key={x}
                                    className="w-8 h-8 border border-purple-500/50 flex items-center justify-center text-white font-bold text-sm"
                                    style={{
                                      backgroundColor: cell !== ' ' ? 'rgba(139, 92, 246, 0.3)' : 'rgba(0, 0, 0, 0.3)'
                                    }}
                                  >
                                    {cell}
                                  </div>
                                ))}
                              </div>
                            ))}
                          </div>
                        </div>

                        <div className="mt-4">
                          <h3 className="text-white font-semibold mb-2">Placed Words:</h3>
                          <div className="grid grid-cols-2 gap-2 text-sm max-h-48 overflow-y-auto">
                            {result.placements.map((p, idx) => (
                              <div key={idx} className="text-purple-200">
                                {idx + 1}. {p.word} ({p.x},{p.y}) {p.horizontal ? '→' : '↓'}
                              </div>
                            ))}
                          </div>
                        </div>
                      </div>
                    )}
                  </div>
                </div>

                <div className="mt-8 text-center text-purple-300 text-sm">
                  <p>
                    Make sure the Flask backend is running on port 5000.
                    Run: <code className="bg-black/30 px-2 py-1 rounded">python app.py</code>
                  </p>
                </div>
              </div>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<CrosswordGenerator />);
    </script>
</body>
</html>